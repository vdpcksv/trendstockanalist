<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trend-Lotto Invest Dashboard</title>

    <!-- âœ… Google AdSense Verification Code (Hardcoded here for SEO Bot Crawlability) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9065075656013134"
        crossorigin="anonymous"></script>

    <!-- Tailwind CSS (CDN for Premium Aesthetic) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Plotly JS (To replace Streamlit charts) -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Custom Premium Aesthetics and overrides */
    </style>
</head>

<body class="bg-slate-50 text-slate-900 overflow-x-hidden min-h-screen">

    <!-- Premium Navigation Bar -->
    <nav class="bg-indigo-600 shadow-lg text-white sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center gap-2">
                    <span class="font-bold text-xl tracking-wide">ğŸ“ˆ Trend-Lotto Invest</span>
                </div>

                <!-- Desktop Nav Link (Hidden on mobile) -->
                <div class="hidden md:flex space-x-6 overflow-x-auto whitespace-nowrap scrollbar-hide">
                    <a href="/" class="hover:bg-indigo-500 px-3 py-2 rounded-md font-medium transition">ğŸ’° ìê¸ˆ íë¦„</a>
                    <a href="/seasonality" class="hover:bg-indigo-500 px-3 py-2 rounded-md font-medium transition">ğŸ—“ï¸
                        ê³„ì ˆì„± íŠ¸ë Œë“œ</a>
                    <a href="/themes" class="hover:bg-indigo-500 px-3 py-2 rounded-md font-medium transition">ğŸ¯ í…Œë§ˆ
                        ë§ì¶¤í˜•</a>
                    <a href="/review" class="hover:bg-indigo-500 px-3 py-2 rounded-md font-medium transition">ğŸ¤– ë§¤ë§¤
                        ë³µê¸°</a>
                    <a href="/portfolio" id="nav-portfolio"
                        class="hidden hover:bg-indigo-500 px-3 py-2 rounded-md font-medium transition">ğŸ’¼
                        í¬íŠ¸í´ë¦¬ì˜¤</a>
                    <a href="/policies" class="hover:bg-indigo-500 px-3 py-2 rounded-md font-medium transition">ğŸ“œ í•„ìˆ˜
                        ì •ì±…</a>
                </div>

                <!-- Auth Section -->
                <div class="flex items-center space-x-4">
                    <span id="user-greeting" class="text-sm font-medium hidden"></span>
                    <button id="btn-login" onclick="openAuthModal()"
                        class="bg-white text-indigo-600 px-4 py-2 rounded-md font-bold text-sm hover:bg-indigo-50 transition">ë¡œê·¸ì¸</button>
                    <button id="btn-logout" onclick="logout()"
                        class="hidden bg-indigo-500 text-white px-4 py-2 rounded-md font-bold text-sm hover:bg-indigo-400 transition border border-indigo-400">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Injection Zone -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 mt-12 py-6 text-center text-slate-500">
        <p class="text-sm">Â© 2026 Trend-Lotto Invest | ë³¸ ì •ë³´ëŠ” ì˜¤ë¥˜ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë©° íˆ¬ì ê²°ê³¼ì— ëŒ€í•œ ì±…ì„ì€ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
    </footer>

    <!-- Auth Modal -->
    <div id="auth-modal" class="hidden fixed inset-0 bg-slate-900 bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-sm">
            <h2 id="auth-title" class="text-xl font-bold mb-4 text-slate-800">ë¡œê·¸ì¸</h2>
            <form id="auth-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700">ì•„ì´ë””</label>
                    <input type="text" id="auth-username" required
                        class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm py-2 px-3 text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="auth-password" required
                        class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm py-2 px-3 text-sm">
                </div>
                <button type="submit"
                    class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700 transition"
                    id="auth-submitBtn">ë¡œê·¸ì¸</button>
            </form>
            <div class="mt-4 text-center text-sm">
                <button onclick="toggleAuthMode()" id="auth-toggleBtn"
                    class="text-indigo-600 font-medium hover:underline">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…</button>
            </div>
            <button onclick="closeAuthModal()"
                class="mt-4 w-full border border-slate-200 text-slate-600 font-bold py-2 px-4 rounded-md hover:bg-slate-50 transition">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- Auth Script -->
    <script>
        let isLoginMode = true;

        function checkAuthState() {
            const token = localStorage.getItem('access_token');
            const username = localStorage.getItem('username');

            if (token && username) {
                document.getElementById('btn-login').classList.add('hidden');
                document.getElementById('btn-logout').classList.remove('hidden');
                const pTag = document.getElementById('user-greeting');
                pTag.textContent = `${username}ë‹˜`;
                pTag.classList.remove('hidden');
                document.getElementById('nav-portfolio').classList.remove('hidden');
            } else {
                document.getElementById('btn-login').classList.remove('hidden');
                document.getElementById('btn-logout').classList.add('hidden');
                document.getElementById('user-greeting').classList.add('hidden');
                document.getElementById('nav-portfolio').classList.add('hidden');
            }
        }

        function openAuthModal() {
            document.getElementById('auth-modal').classList.remove('hidden');
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
            document.getElementById('auth-form').reset();
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('auth-title').innerText = isLoginMode ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…';
            document.getElementById('auth-submitBtn').innerText = isLoginMode ? 'ë¡œê·¸ì¸' : 'ê°€ì…í•˜ê¸°';
            document.getElementById('auth-toggleBtn').innerText = isLoginMode ? 'ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…' : 'ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸';
        }

        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const u = document.getElementById('auth-username').value;
            const p = document.getElementById('auth-password').value;

            if (isLoginMode) {
                // Login
                try {
                    const formData = new URLSearchParams();
                    formData.append('username', u);
                    formData.append('password', p);

                    const res = await fetch('/api/token', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData
                    });
                    if (res.ok) {
                        const data = await res.json();
                        localStorage.setItem('access_token', data.access_token);
                        localStorage.setItem('username', u);
                        localStorage.setItem('membership', data.membership);
                        closeAuthModal();
                        checkAuthState();
                        window.location.reload(); // Refresh to apply paywalls
                    } else {
                        alert("ë¡œê·¸ì¸ ì‹¤íŒ¨. ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                    }
                } catch (err) { console.error(err); }
            } else {
                // Register
                try {
                    const res = await fetch('/api/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username: u, password: p })
                    });
                    if (res.ok) {
                        alert("íšŒì›ê°€ì… ì„±ê³µ! ì´ì œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
                        toggleAuthMode();
                    } else {
                        const err = await res.json();
                        alert(`íšŒì›ê°€ì… ì‹¤íŒ¨: ${err.detail}`);
                    }
                } catch (err) { console.error(err); }
            }
        });

        function logout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('username');
            localStorage.removeItem('membership');
            checkAuthState();
            window.location.href = '/';
        }

        // Initialize state
        checkAuthState();
    </script>
</body>

</html>