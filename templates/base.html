<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trend-Lotto Invest Dashboard</title>

    <!-- âœ… Google AdSense Verification Code (Hardcoded here for SEO Bot Crawlability) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9065075656013134"
        crossorigin="anonymous"></script>

    <!-- Tailwind CSS (CDN for Premium Aesthetic) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Plotly JS (To replace Streamlit charts) -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Google Fonts: Inter for readibility, Outfit for premium headings -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0B1021 0%, #17203B 50%, #0B1021 100%);
            background-attachment: fixed;
            color: #cbd5e1;
            /* slate-300 */
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        .outfit-font {
            font-family: 'Outfit', sans-serif;
            letter-spacing: -0.025em;
        }

        /* Glassmorphism utility - Dark Theme */
        .glass-nav {
            background: rgba(11, 16, 33, 0.65);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-nav a {
            color: #94a3b8;
            /* slate-400 */
        }

        .glass-nav a:hover {
            color: #818cf8;
            /* indigo-400 */
            background: rgba(129, 140, 248, 0.1);
        }

        /* Glass Card Utility */
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        /* Custom Animations */
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3), 0 8px 10px -6px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body class="text-slate-300 overflow-x-hidden min-h-screen flex flex-col selection:bg-indigo-500/30">

    <!-- Premium Navigation Bar (Glassmorphism) -->
    <nav class="glass-nav shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center gap-2">
                    <span class="font-extrabold text-2xl tracking-tight text-white outfit-font drop-shadow-md">ğŸ“‰
                        Trend-<span class="text-indigo-400">Lotto</span></span>
                </div>

                <!-- Desktop Nav Link (Hidden on mobile) -->
                <div class="hidden md:flex space-x-2 overflow-x-auto whitespace-nowrap scrollbar-hide ml-8">
                    <a href="/" class="px-3 py-2 rounded-lg font-semibold transition-colors duration-200">ğŸ’° ìê¸ˆ íë¦„</a>
                    <a href="/seasonality" class="px-3 py-2 rounded-lg font-semibold transition-colors duration-200">ğŸ—“ï¸
                        ê³„ì ˆì„± íŠ¸ë Œë“œ</a>
                    <a href="/themes" class="px-3 py-2 rounded-lg font-semibold transition-colors duration-200">ğŸ¯ í…Œë§ˆ
                        ë¶„ì„</a>
                    <a href="/review" class="px-3 py-2 rounded-lg font-semibold transition-colors duration-200">ğŸ¤– AI ë§¤ë§¤
                        ë³µê¸°</a>
                    <a href="/portfolio" id="nav-portfolio"
                        class="hidden px-3 py-2 rounded-lg font-semibold transition-colors duration-200">ğŸ’¼ ë‚´ ìì‚°</a>
                    <a href="/policies" class="px-3 py-2 rounded-lg font-semibold transition-colors duration-200">ğŸ“œ í•„ìˆ˜
                        ì •ì±…</a>
                </div>

                <!-- Auth Section -->
                <div class="flex items-center space-x-3">
                    <span id="user-greeting" class="text-sm font-semibold text-indigo-300 hidden"></span>
                    <button id="btn-login" onclick="openAuthModal()"
                        class="bg-indigo-600/90 backdrop-blur-sm border border-indigo-500/50 text-white px-5 py-2 rounded-full font-bold text-sm hover:bg-indigo-500 hover:shadow-[0_0_15px_rgba(99,102,241,0.5)] transition-all duration-300">
                        ë¡œê·¸ì¸
                    </button>
                    <button id="btn-logout" onclick="logout()"
                        class="hidden bg-slate-800/80 backdrop-blur-sm text-slate-300 px-5 py-2 rounded-full font-bold text-sm hover:text-rose-400 hover:bg-rose-500/10 border border-slate-700 hover:border-rose-500/30 transition-all duration-300">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Injection Zone -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 w-full flex-grow flex flex-col">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-[#0B1021]/80 backdrop-blur-md border-t border-white/10 mt-auto py-8 text-center text-slate-400">
        <p class="text-sm font-medium text-slate-300">Â© 2026 Trend-Lotto Executive Terminal. All rights reserved.</p>
        <p class="text-xs text-slate-500 mt-2">ë³¸ ì •ë³´ëŠ” í€€íŠ¸ ê¸°ë°˜ ì•Œê³ ë¦¬ì¦˜ì— ì˜í•´ ìë™ ì¶”ì¶œëœ ë°ì´í„°ì´ë©°, íˆ¬ìì˜ ìµœì¢… ì±…ì„ì€ ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤.</p>
    </footer>

    <!-- Auth Modal -->
    <div id="auth-modal"
        class="hidden fixed inset-0 bg-[#0B1021]/80 backdrop-blur-sm z-50 flex items-center justify-center">
        <div class="glass-card p-8 rounded-2xl shadow-2xl w-full max-w-sm border border-indigo-500/20">
            <h2 id="auth-title" class="text-2xl font-bold mb-6 text-white text-center">ë¡œê·¸ì¸</h2>
            <form id="auth-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-1">ì•„ì´ë””</label>
                    <input type="text" id="auth-username" required
                        class="block w-full bg-[#151b30] border border-slate-700 rounded-lg shadow-inner py-2.5 px-3 text-sm text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-1">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="auth-password" required
                        class="block w-full bg-[#151b30] border border-slate-700 rounded-lg shadow-inner py-2.5 px-3 text-sm text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none transition-colors">
                </div>
                <button type="submit"
                    class="w-full bg-gradient-to-r from-indigo-600 to-indigo-500 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-indigo-500/30 transition-all duration-300 mt-2"
                    id="auth-submitBtn">ë¡œê·¸ì¸</button>
            </form>
            <div class="mt-5 text-center text-sm">
                <button onclick="toggleAuthMode()" id="auth-toggleBtn"
                    class="text-indigo-400 font-medium hover:text-indigo-300 transition-colors">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…</button>
            </div>
            <button onclick="closeAuthModal()"
                class="mt-4 w-full border border-slate-700 text-slate-300 font-bold py-2.5 px-4 rounded-lg hover:bg-slate-800 transition-colors">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- Auth Script -->
    <script>
        let isLoginMode = true;

        function checkAuthState() {
            const token = localStorage.getItem('access_token');
            const username = localStorage.getItem('username');

            if (token && username) {
                document.getElementById('btn-login').classList.add('hidden');
                document.getElementById('btn-logout').classList.remove('hidden');
                const pTag = document.getElementById('user-greeting');
                pTag.textContent = `${username}ë‹˜`;
                pTag.classList.remove('hidden');
                document.getElementById('nav-portfolio').classList.remove('hidden');
            } else {
                document.getElementById('btn-login').classList.remove('hidden');
                document.getElementById('btn-logout').classList.add('hidden');
                document.getElementById('user-greeting').classList.add('hidden');
                document.getElementById('nav-portfolio').classList.add('hidden');
            }
        }

        function openAuthModal() {
            document.getElementById('auth-modal').classList.remove('hidden');
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
            document.getElementById('auth-form').reset();
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('auth-title').innerText = isLoginMode ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…';
            document.getElementById('auth-submitBtn').innerText = isLoginMode ? 'ë¡œê·¸ì¸' : 'ê°€ì…í•˜ê¸°';
            document.getElementById('auth-toggleBtn').innerText = isLoginMode ? 'ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…' : 'ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸';
        }

        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const u = document.getElementById('auth-username').value;
            const p = document.getElementById('auth-password').value;

            if (isLoginMode) {
                // Login
                try {
                    const formData = new URLSearchParams();
                    formData.append('username', u);
                    formData.append('password', p);

                    const res = await fetch('/api/token', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData
                    });
                    if (res.ok) {
                        const data = await res.json();
                        localStorage.setItem('access_token', data.access_token);
                        localStorage.setItem('username', u);
                        localStorage.setItem('membership', data.membership);
                        closeAuthModal();
                        checkAuthState();
                        window.location.reload(); // Refresh to apply paywalls
                    } else {
                        alert("ë¡œê·¸ì¸ ì‹¤íŒ¨. ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                    }
                } catch (err) { console.error(err); }
            } else {
                // Register
                try {
                    const res = await fetch('/api/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username: u, password: p })
                    });
                    if (res.ok) {
                        alert("íšŒì›ê°€ì… ì„±ê³µ! ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ë©ë‹ˆë‹¤.");
                        const loginFormData = new URLSearchParams();
                        loginFormData.append('username', u);
                        loginFormData.append('password', p);

                        const loginRes = await fetch('/api/token', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                            body: loginFormData
                        });

                        if (loginRes.ok) {
                            const loginData = await loginRes.json();
                            localStorage.setItem('access_token', loginData.access_token);
                            localStorage.setItem('username', u);
                            localStorage.setItem('membership', loginData.membership);
                            closeAuthModal();
                            checkAuthState();
                            window.location.reload();
                        } else {
                            toggleAuthMode();
                        }
                    } else {
                        const err = await res.json();
                        alert(`íšŒì›ê°€ì… ì‹¤íŒ¨: ${err.detail}`);
                    }
                } catch (err) { console.error(err); }
            }
        });

        function logout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('username');
            localStorage.removeItem('membership');
            checkAuthState();
            window.location.href = '/';
        }

        // Initialize state
        checkAuthState();
    </script>
</body>

</html>