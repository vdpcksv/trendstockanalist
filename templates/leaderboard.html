{% extends "base.html" %}

{% block content %}
<div class="mb-10 flex flex-col items-center text-center">
    <div
        class="inline-block bg-yellow-500/20 border border-yellow-400/30 text-yellow-300 px-4 py-1.5 rounded-full text-sm font-semibold mb-4 drop-shadow-sm">
        AlphaFinder Competition</div>
    <h1 class="text-4xl font-extrabold text-white mb-4 tracking-tight drop-shadow-md">ğŸ† ëª¨ì˜íˆ¬ì ëª…ì˜ˆì˜ ì „ë‹¹</h1>
    <p class="text-slate-400 max-w-2xl text-lg">
        ê°€ì¥ ë›°ì–´ë‚œ ì¢…ëª© ë¶„ì„ê³¼ ë§¤ë§¤ íƒ€ì´ë°ìœ¼ë¡œ ìµœê³ ì˜ ìˆ˜ìµë¥ ì„ ê¸°ë¡ ì¤‘ì¸<br class="hidden sm:block">íˆ¬ì ê³ ìˆ˜ë“¤ì˜ ë­í‚¹ì„ í™•ì¸í•˜ì„¸ìš”. (ë§¤ì¼ ìì • ì •ì‚°)
    </p>
</div>

<!-- Leaderboard Container -->
<div
    class="glass-card rounded-2xl p-6 md:p-10 max-w-4xl mx-auto shadow-2xl border border-yellow-500/20 relative overflow-hidden">
    <!-- Background Glow -->
    <div
        class="absolute top-0 right-0 w-64 h-64 bg-yellow-500/10 rounded-full blur-3xl pointer-events-none -mr-16 -mt-16">
    </div>
    <div
        class="absolute bottom-0 left-0 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl pointer-events-none -ml-16 -mb-16">
    </div>

    <div class="flex justify-between items-center mb-8 relative z-10 border-b border-slate-700/50 pb-4">
        <h2 class="text-2xl font-bold text-white flex items-center gap-3">
            <span class="text-3xl">ğŸ‘‘</span> TOP 10 ë­í¬ë³´ë“œ
        </h2>
        <span class="text-xs bg-slate-800/80 px-3 py-1.5 rounded border border-slate-700 text-slate-400">ìì • ì—…ë°ì´íŠ¸</span>
    </div>

    <!-- Leaderboard Table -->
    <div class="w-full overflow-x-auto relative z-10">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="text-slate-400 text-sm border-b border-slate-700/50 bg-[#0B1021]/50">
                    <th class="py-4 px-6 font-bold uppercase tracking-wider w-20 text-center">ìˆœìœ„</th>
                    <th class="py-4 px-6 font-bold uppercase tracking-wider">íˆ¬ìì (ë‹‰ë„¤ì„)</th>
                    <th class="py-4 px-6 font-bold uppercase tracking-wider text-right">ì¶”ì • ì´ ìˆ˜ìµë¥  (%)</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body" class="divide-y divide-slate-800/50">
                <!-- Data will be injected via JS -->
                <tr>
                    <td colspan="3" class="text-center py-12 text-slate-500 text-sm">
                        <svg class="animate-spin h-8 w-8 text-yellow-500 mx-auto mb-4"
                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        ë­í‚¹ ë°ì´í„°ë¥¼ ì§‘ê³„ ì¤‘ì…ë‹ˆë‹¤...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/api/leaderboard?limit=10')
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById('leaderboard-body');
                tbody.innerHTML = '';

                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" class="text-center py-10 text-slate-500">ì•„ì§ ì •ì‚°ëœ ìˆ˜ìµë¥  ë­í‚¹ì´ ì—†ìŠµë‹ˆë‹¤. íˆ¬ìë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!</td></tr>';
                    return;
                }

                data.forEach((user, index) => {
                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-slate-800/30 transition-colors group';

                    // Styling explicitly for Rank 1, 2, 3
                    let rankVisual = `<span class="text-slate-400 font-bold">${user.rank}</span>`;
                    if (user.rank === 1) rankVisual = `<span class="text-2xl pt-1">ğŸ¥‡</span>`;
                    else if (user.rank === 2) rankVisual = `<span class="text-2xl pt-1">ğŸ¥ˆ</span>`;
                    else if (user.rank === 3) rankVisual = `<span class="text-2xl pt-1">ğŸ¥‰</span>`;

                    // Return Rate Styling
                    let returnVal = user.return;
                    if (returnVal === null || returnVal === undefined) returnVal = 0;

                    let returnColor = 'text-slate-300';
                    let returnSign = '';
                    if (returnVal > 0) {
                        returnColor = 'text-rose-400 font-bold drop-shadow-[0_0_8px_rgba(244,63,94,0.4)]';
                        returnSign = '+';
                    } else if (returnVal < 0) {
                        returnColor = 'text-blue-400 font-bold drop-shadow-[0_0_8px_rgba(96,165,250,0.4)]';
                    }

                    tr.innerHTML = `
                    <td class="py-4 px-6 text-center align-middle">${rankVisual}</td>
                    <td class="py-4 px-6 font-bold text-slate-200 group-hover:text-indigo-300 transition-colors">
                        @${user.username}
                        ${user.rank === 1 ? '<span class="ml-2 text-xs bg-yellow-500/20 text-yellow-300 px-2 py-0.5 rounded-full border border-yellow-500/50">Whale</span>' : ''}
                    </td>
                    <td class="py-4 px-6 text-right ${returnColor} text-lg">
                        ${returnSign}${returnVal.toFixed(2)}%
                    </td>
                `;
                    tbody.appendChild(tr);
                });
            })
            .catch(err => {
                console.error(err);
                document.getElementById('leaderboard-body').innerHTML = '<tr><td colspan="3" class="text-center py-10 text-rose-400">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
            });
    });
</script>
{% endblock %}